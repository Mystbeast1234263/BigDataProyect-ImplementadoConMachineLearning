<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a de Despliegue - GAMC Big Data Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 60px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: visible;
            min-height: 100%;
        }

        .download-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: background 0.3s;
        }

        .download-btn:hover {
            background: #1d4ed8;
        }

        .download-btn:active {
            transform: scale(0.98);
        }

        header {
            border-bottom: 3px solid #2563eb;
            padding-bottom: 20px;
            margin-bottom: 40px;
        }

        h1 {
            color: #1e40af;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 5px;
        }

        h2 {
            color: #1e40af;
            font-size: 24px;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
            page-break-after: avoid;
        }

        h3 {
            color: #334155;
            font-size: 20px;
            margin-top: 30px;
            margin-bottom: 15px;
            page-break-after: avoid;
        }

        h4 {
            color: #475569;
            font-size: 18px;
            margin-top: 25px;
            margin-bottom: 12px;
            page-break-after: avoid;
        }

        p {
            margin-bottom: 15px;
            text-align: justify;
        }

        ul, ol {
            margin-left: 30px;
            margin-bottom: 20px;
        }

        li {
            margin-bottom: 8px;
        }

        code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #dc2626;
        }

        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            page-break-inside: avoid;
            font-size: 13px;
            line-height: 1.5;
        }

        pre code {
            background: transparent;
            color: #e2e8f0;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            page-break-inside: avoid;
        }

        th, td {
            border: 1px solid #cbd5e1;
            padding: 12px;
            text-align: left;
        }

        th {
            background: #1e40af;
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background: #f8fafc;
        }

        .toc {
            background: #f8fafc;
            padding: 30px;
            border-radius: 8px;
            margin: 30px 0;
            page-break-inside: avoid;
        }

        .toc h2 {
            margin-top: 0;
            border-bottom: none;
        }

        .toc ul {
            list-style: none;
            margin-left: 0;
        }

        .toc li {
            margin-bottom: 10px;
        }

        .toc a {
            color: #2563eb;
            text-decoration: none;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        .section {
            page-break-before: always;
        }

        .section:first-child {
            page-break-before: auto;
        }

        .note {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            page-break-inside: avoid;
        }

        .warning {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            page-break-inside: avoid;
        }

        .success {
            background: #d1fae5;
            border-left: 4px solid #10b981;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            page-break-inside: avoid;
        }

        footer {
            margin-top: 60px;
            padding-top: 20px;
            border-top: 2px solid #e2e8f0;
            text-align: center;
            color: #64748b;
            font-size: 14px;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
                padding: 40px;
                max-width: 100%;
                width: 100%;
            }

            .download-btn {
                display: none !important;
            }

            .section {
                page-break-before: auto;
            }

            .section:first-of-type {
                page-break-before: auto;
            }

            h2 {
                page-break-after: avoid;
                page-break-inside: avoid;
            }

            h3, h4 {
                page-break-after: avoid;
            }

            pre {
                page-break-inside: avoid;
                overflow: visible;
                white-space: pre-wrap;
                word-wrap: break-word;
            }

            table {
                page-break-inside: avoid;
            }

            .note, .warning, .success {
                page-break-inside: avoid;
            }

            @page {
                size: A4;
                margin: 1.5cm;
            }
        }

        /* Estilos espec√≠ficos para html2pdf */
        .container {
            overflow: visible !important;
        }

        pre code {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        @media screen {
            .section {
                page-break-before: auto;
            }
        }
    </style>
</head>
<body>
    <button class="download-btn" onclick="downloadPDF()">üì• Descargar PDF</button>

    <div class="container" id="content">
        <header>
            <h1>GU√çA DE DESPLIEGUE</h1>
            <p class="subtitle"><strong>GAMC Big Data Dashboard</strong></p>
            <p class="subtitle">Sistema de An√°lisis y Predicci√≥n con Machine Learning</p>
            <p class="subtitle">Versi√≥n 1.0 | Diciembre 2024</p>
        </header>

        <div class="toc">
            <h2>√çNDICE</h2>
            <ul>
                <li><a href="#requisitos">1. Requisitos del Sistema</a></li>
                <li><a href="#instalacion">2. Instalaci√≥n Local</a></li>
                <li><a href="#configuracion">3. Configuraci√≥n</a></li>
                <li><a href="#ejecucion">4. Ejecuci√≥n</a></li>
                <li><a href="#endpoints">5. Endpoints de API</a></li>
                <li><a href="#flujo">6. Flujo de Entrenamiento y Predicciones</a></li>
                <li><a href="#produccion">7. Despliegue en Producci√≥n</a></li>
                <li><a href="#problemas">8. Soluci√≥n de Problemas</a></li>
            </ul>
        </div>

        <div class="section" id="requisitos">
            <h2>1. REQUISITOS DEL SISTEMA</h2>
            
            <h3>1.1 Requisitos M√≠nimos</h3>
            
            <p><strong>Sistema Operativo:</strong></p>
            <ul>
                <li>Windows 10/11, macOS 10.15+, o Linux (Ubuntu 20.04+)</li>
            </ul>

            <p><strong>Software Requerido:</strong></p>
            <ul>
                <li><strong>Python 3.8+</strong>: Lenguaje del backend</li>
                <li><strong>Node.js 18+</strong>: Runtime para el frontend</li>
                <li><strong>npm 9+</strong> o <strong>yarn 1.22+</strong>: Gestor de paquetes Node.js</li>
                <li><strong>Git</strong>: Control de versiones</li>
            </ul>

            <p><strong>Servicios Externos:</strong></p>
            <ul>
                <li><strong>MongoDB Atlas</strong>: Base de datos en la nube (cuenta gratuita disponible)</li>
                <li><strong>Supabase</strong>: Autenticaci√≥n (opcional, puede usar autenticaci√≥n local)</li>
            </ul>

            <h3>1.2 Recursos del Sistema</h3>

            <p><strong>M√≠nimo:</strong></p>
            <ul>
                <li>RAM: 4 GB</li>
                <li>Disco: 2 GB libres</li>
                <li>CPU: 2 cores</li>
            </ul>

            <p><strong>Recomendado:</strong></p>
            <ul>
                <li>RAM: 8 GB</li>
                <li>Disco: 5 GB libres</li>
                <li>CPU: 4 cores</li>
            </ul>
        </div>

        <div class="section" id="instalacion">
            <h2>2. INSTALACI√ìN LOCAL</h2>

            <h3>2.1 Diagrama del Flujo de Despliegue</h3>
            <div class="note">
                <strong>Nota:</strong> El diagrama muestra el flujo completo desde clonar el repositorio hasta tener el sistema funcionando.
            </div>

            <h3>2.2 Paso 1: Clonar Repositorio</h3>
            <pre><code># Clonar el repositorio
git clone &lt;URL_DEL_REPOSITORIO&gt;
cd BigDataProyect2-Joel</code></pre>

            <p><strong>Verificaci√≥n:</strong></p>
            <pre><code># Verificar estructura
ls -la
# Deber√≠as ver: backend/, frontend/, docs/, README.md</code></pre>

            <h3>2.3 Paso 2: Configurar Backend</h3>

            <h4>2.3.1 Crear Entorno Virtual</h4>

            <p><strong>Windows (PowerShell):</strong></p>
            <pre><code># Crear entorno virtual
python -m venv venv

# Activar entorno virtual
.\venv\Scripts\Activate.ps1</code></pre>

            <p><strong>Windows (CMD):</strong></p>
            <pre><code>python -m venv venv
venv\Scripts\activate</code></pre>

            <p><strong>Linux/macOS:</strong></p>
            <pre><code>python3 -m venv venv
source venv/bin/activate</code></pre>

            <p><strong>Verificaci√≥n:</strong></p>
            <pre><code># Deber√≠as ver (venv) al inicio del prompt
which python  # Linux/macOS
where python  # Windows</code></pre>

            <h4>2.3.2 Instalar Dependencias</h4>
            <pre><code># Instalar dependencias Python
pip install --upgrade pip
pip install -r backend/requirements.txt</code></pre>

            <p><strong>Dependencias Principales:</strong></p>
            <ul>
                <li><code>fastapi</code>: Framework web</li>
                <li><code>uvicorn</code>: Servidor ASGI</li>
                <li><code>pymongo</code>: Cliente MongoDB</li>
                <li><code>pandas</code>: Procesamiento de datos</li>
                <li><code>scikit-learn</code>: Machine Learning</li>
                <li><code>matplotlib</code>, <code>seaborn</code>: Visualizaciones</li>
                <li><code>python-dotenv</code>: Variables de entorno</li>
            </ul>

            <p><strong>Verificaci√≥n:</strong></p>
            <pre><code>pip list | grep fastapi
# Deber√≠a mostrar: fastapi x.x.x</code></pre>

            <h3>2.4 Paso 3: Configurar Frontend</h3>
            <pre><code># Navegar a carpeta frontend
cd frontend

# Instalar dependencias Node.js
npm install
# O con yarn: yarn install</code></pre>

            <p><strong>Dependencias Principales:</strong></p>
            <ul>
                <li><code>react</code>: Biblioteca UI</li>
                <li><code>react-router-dom</code>: Navegaci√≥n</li>
                <li><code>axios</code>: Cliente HTTP</li>
                <li><code>recharts</code>: Gr√°ficos interactivos</li>
                <li><code>tailwindcss</code>: Framework CSS</li>
            </ul>

            <p><strong>Verificaci√≥n:</strong></p>
            <pre><code>npm list react
# Deber√≠a mostrar: react@18.x.x</code></pre>

            <h3>2.5 Paso 4: Configurar Variables de Entorno</h3>

            <p>Crear archivo <code>.env</code> en la ra√≠z del proyecto:</p>
            <pre><code># Desde la ra√≠z del proyecto
cd ..
touch .env  # Linux/macOS
# O crear manualmente en Windows</code></pre>

            <p><strong>Contenido del archivo <code>.env</code>:</strong></p>
            <pre><code># MongoDB Atlas
MONGO_URI=mongodb+srv://usuario:password@cluster.mongodb.net/database?retryWrites=true&w=majority

# Supabase (Opcional)
SUPABASE_URL=https://tu-proyecto.supabase.co
SUPABASE_SERVICE_ROLE_KEY=tu-service-role-key

# JWT Secret
JWT_SECRET_KEY=tu-clave-secreta-muy-segura-aqui-minimo-32-caracteres

# Backend
BACKEND_URL=http://localhost:8000
FRONTEND_URL=http://localhost:5173</code></pre>

            <div class="note">
                <strong>Obtener MongoDB URI:</strong>
                <ol>
                    <li>Crear cuenta en <a href="https://www.mongodb.com/cloud/atlas">MongoDB Atlas</a></li>
                    <li>Crear un cluster (gratis disponible)</li>
                    <li>Crear usuario de base de datos</li>
                    <li>Whitelist IP (0.0.0.0/0 para desarrollo)</li>
                    <li>Copiar connection string y reemplazar <code>&lt;password&gt;</code> con tu contrase√±a</li>
                </ol>
            </div>

            <p><strong>Verificaci√≥n:</strong></p>
            <pre><code># Verificar que el archivo existe
cat .env  # Linux/macOS
type .env  # Windows</code></pre>
        </div>

        <div class="section" id="configuracion">
            <h2>3. CONFIGURACI√ìN</h2>

            <h3>3.1 Configurar MongoDB Atlas</h3>
            <ol>
                <li><strong>Crear Base de Datos:</strong> Nombre sugerido: <code>gamc_bigdata</code></li>
                <li><strong>Crear Colecciones</strong> (se crean autom√°ticamente al insertar datos):
                    <ul>
                        <li><code>air_sensors</code></li>
                        <li><code>sound_sensors</code></li>
                        <li><code>underground_sensors</code></li>
                    </ul>
                </li>
                <li><strong>Configurar √çndices</strong> (opcional, se crean autom√°ticamente):
                    <pre><code>// En MongoDB Compass o shell
db.air_sensors.createIndex({deviceName: 1, time: 1}, {unique: true})
db.sound_sensors.createIndex({deviceName: 1, time: 1}, {unique: true})
db.underground_sensors.createIndex({deviceName: 1, time: 1}, {unique: true})</code></pre>
                </li>
            </ol>

            <h3>3.2 Configurar Supabase (Opcional)</h3>
            <p>Si usas Supabase para autenticaci√≥n:</p>
            <ol>
                <li><strong>Crear Tabla de Usuarios:</strong>
                    <pre><code>CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  email TEXT UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);</code></pre>
                </li>
                <li><strong>Configurar JWT Secret:</strong> Usar el mismo <code>JWT_SECRET_KEY</code> del <code>.env</code></li>
            </ol>
        </div>

        <div class="section" id="ejecucion">
            <h2>4. EJECUCI√ìN</h2>

            <h3>4.1 Opci√≥n 1: Ejecutar Todo Autom√°ticamente (Recomendado)</h3>

            <p><strong>Windows:</strong></p>
            <pre><code># Ejecutar script que inicia backend y frontend
.\start_all.bat</code></pre>

            <p><strong>PowerShell:</strong></p>
            <pre><code>.\start_all.ps1</code></pre>

            <h3>4.2 Opci√≥n 2: Ejecutar por Separado</h3>

            <h4>4.2.1 Terminal 1 - Backend</h4>
            <pre><code># Activar entorno virtual (si no est√° activo)
# Windows:
.\venv\Scripts\Activate.ps1
# Linux/macOS:
source venv/bin/activate

# Navegar a backend
cd backend

# Ejecutar servidor
python -m uvicorn main:app --reload --host 0.0.0.0 --port 8000</code></pre>

            <div class="success">
                <strong>Verificaci√≥n:</strong> Abrir navegador: <a href="http://localhost:8000/docs">http://localhost:8000/docs</a><br>
                Deber√≠as ver la documentaci√≥n interactiva de Swagger.
            </div>

            <h4>4.2.2 Terminal 2 - Frontend</h4>
            <pre><code># Navegar a frontend
cd frontend

# Ejecutar servidor de desarrollo
npm run dev
# O con yarn: yarn dev</code></pre>

            <div class="success">
                <strong>Verificaci√≥n:</strong> Abrir navegador: <a href="http://localhost:5173">http://localhost:5173</a><br>
                Deber√≠as ver el dashboard.
            </div>

            <h3>4.3 Verificar que Todo Funciona</h3>
            <ol>
                <li><strong>Backend:</strong> <a href="http://localhost:8000/docs">http://localhost:8000/docs</a>
                    <ul>
                        <li>Deber√≠as ver la documentaci√≥n de Swagger</li>
                        <li>Probar endpoint: <code>GET /api/sensors/air/data</code></li>
                    </ul>
                </li>
                <li><strong>Frontend:</strong> <a href="http://localhost:5173">http://localhost:5173</a>
                    <ul>
                        <li>Deber√≠as ver el dashboard principal</li>
                        <li>Iniciar sesi√≥n (crear cuenta si es necesario)</li>
                    </ul>
                </li>
            </ol>
        </div>

        <div class="section" id="endpoints">
            <h2>5. ENDPOINTS DE API</h2>

            <h3>5.1 Autenticaci√≥n</h3>

            <h4>Login</h4>
            <pre><code>POST http://localhost:8000/api/auth/login
Content-Type: application/json

{
  "email": "usuario@ejemplo.com",
  "password": "contrase√±a"
}</code></pre>

            <p><strong>Respuesta:</strong></p>
            <pre><code>{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "user": {
    "email": "usuario@ejemplo.com"
  }
}</code></pre>

            <h4>Registro</h4>
            <pre><code>POST http://localhost:8000/api/auth/register
Content-Type: application/json

{
  "email": "nuevo@ejemplo.com",
  "password": "contrase√±a_segura"
}</code></pre>

            <h3>5.2 Sensores</h3>

            <h4>Obtener Datos</h4>
            <pre><code>GET http://localhost:8000/api/sensors/air/data?days_back=30&limit=1000
Authorization: Bearer {token}</code></pre>

            <p><strong>Par√°metros:</strong></p>
            <ul>
                <li><code>days_back</code>: D√≠as hacia atr√°s (default: 30)</li>
                <li><code>limit</code>: L√≠mite de registros (default: 5000)</li>
                <li><code>date_from</code>: Fecha inicio (YYYY-MM-DD, opcional)</li>
                <li><code>date_to</code>: Fecha fin (YYYY-MM-DD, opcional)</li>
            </ul>

            <h3>5.3 Machine Learning</h3>

            <h4>Entrenar Modelo</h4>
            <pre><code>POST http://localhost:8000/api/ml/train
Authorization: Bearer {token}
Content-Type: application/json

{
  "sensor_type": "air",
  "metric": "co2_ppm",
  "date_from": "2024-11-15",
  "date_to": "2024-12-30",
  "model_type": "auto",
  "test_size": 0.2,
  "random_state": 42
}</code></pre>

            <h4>Predicci√≥n por Fecha</h4>
            <pre><code>POST http://localhost:8000/api/ml/predict/regression
Authorization: Bearer {token}
Content-Type: application/json

{
  "sensor_type": "air",
  "metric": "co2_ppm",
  "prediction_date": "2024-12-15",
  "model_key": "air_co2_ppm_random_forest"
}</code></pre>

            <h4>Predicci√≥n por Mes</h4>
            <pre><code>POST http://localhost:8000/api/ml/predict/regression
Authorization: Bearer {token}
Content-Type: application/json

{
  "sensor_type": "air",
  "metric": "co2_ppm",
  "prediction_month": "2024-12",
  "model_key": "air_co2_ppm_random_forest"
}</code></pre>
        </div>

        <div class="section" id="flujo">
            <h2>6. FLUJO DE ENTRENAMIENTO Y PREDICCIONES</h2>

            <h3>6.1 Flujo Completo</h3>
            <p>El flujo completo incluye: verificaci√≥n de datos, entrenamiento de modelos, y generaci√≥n de predicciones.</p>

            <h3>6.2 Pasos Detallados para Entrenar un Modelo</h3>
            <ol>
                <li><strong>Verificar Datos</strong> (ML Wizard Paso 1):
                    <ul>
                        <li>Seleccionar tipo de sensor (Air, Sound, Underground)</li>
                        <li>Seleccionar m√©trica (CO‚ÇÇ, Temperatura, etc.)</li>
                        <li>El sistema verifica disponibilidad de datos</li>
                    </ul>
                </li>
                <li><strong>Configurar Entrenamiento</strong> (ML Wizard Paso 2):
                    <ul>
                        <li>Seleccionar rango de fechas (opcional)</li>
                        <li>Configurar par√°metros (test_size, random_state)</li>
                        <li>Click en "Entrenar Modelo"</li>
                    </ul>
                </li>
                <li><strong>Ver Resultados</strong> (ML Wizard Paso 3-4):
                    <ul>
                        <li>Progreso del entrenamiento</li>
                        <li>M√©tricas de los 3 modelos</li>
                        <li>Modelo seleccionado (mejor F1-Score)</li>
                        <li>Matriz de confusi√≥n</li>
                        <li>Gr√°ficos de rendimiento</li>
                    </ul>
                </li>
                <li><strong>Hacer Predicciones</strong> (ML Wizard Paso 5):
                    <ul>
                        <li>Seleccionar modelo entrenado</li>
                        <li>Elegir tipo de predicci√≥n: Por Fecha, Por Mes, Por Semana</li>
                        <li>Ver gr√°ficos interactivos</li>
                        <li>Filtrar por clase (normal/warning/critical)</li>
                    </ul>
                </li>
            </ol>

            <h3>6.3 Ejemplo Completo: Entrenar y Predecir CO‚ÇÇ</h3>

            <h4>Paso 1: Entrenar Modelo</h4>
            <pre><code># Usando curl (o Postman/Thunder Client)
curl -X POST http://localhost:8000/api/ml/train \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "sensor_type": "air",
    "metric": "co2_ppm",
    "date_from": "2024-11-15",
    "date_to": "2024-12-30",
    "model_type": "auto"
  }'</code></pre>

            <p><strong>Resultado Esperado:</strong></p>
            <ul>
                <li>Modelo guardado: <code>backend/models/air_co2_ppm_random_forest.pkl</code></li>
                <li>M√©tricas guardadas: <code>backend/models/air_co2_ppm_random_forest_metrics.json</code></li>
                <li>Matriz de confusi√≥n: <code>backend/models/air_co2_ppm_random_forest_confusion_matrix.png</code></li>
                <li>F1-Score: ‚â•0.85 (85%)</li>
            </ul>

            <h4>Paso 2: Hacer Predicci√≥n</h4>
            <pre><code>curl -X POST http://localhost:8000/api/ml/predict/regression \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "sensor_type": "air",
    "metric": "co2_ppm",
    "prediction_date": "2024-12-15",
    "model_key": "air_co2_ppm_random_forest"
  }'</code></pre>

            <p><strong>Resultado Esperado:</strong></p>
            <ul>
                <li>3 predicciones horarias (8:00, 14:00, 20:00)</li>
                <li>Valores num√©ricos (<code>predicted_value</code>)</li>
                <li>Clases predichas (<code>predicted_class</code>)</li>
                <li>Confianza (<code>confidence</code>)</li>
            </ul>
        </div>

        <div class="section" id="produccion">
            <h2>7. DESPLIEGUE EN PRODUCCI√ìN</h2>

            <h3>7.1 Opci√≥n 1: Railway (Recomendado para Inicio)</h3>
            <ol>
                <li><strong>Crear Cuenta:</strong> <a href="https://railway.app">https://railway.app</a></li>
                <li><strong>Conectar Repositorio:</strong> GitHub/GitLab</li>
                <li><strong>Configurar Variables de Entorno:</strong> En el dashboard de Railway</li>
                <li><strong>Desplegar:</strong> Railway detecta autom√°ticamente Python/Node.js</li>
            </ol>

            <p><strong>Ventajas:</strong></p>
            <ul>
                <li>Despliegue autom√°tico desde GitHub</li>
                <li>SSL autom√°tico</li>
                <li>Escalado f√°cil</li>
            </ul>

            <h3>7.2 Opci√≥n 2: VPS (Hostinger, DigitalOcean, etc.)</h3>

            <h4>7.2.1 Configurar Servidor</h4>
            <pre><code># Actualizar sistema
sudo apt update && sudo apt upgrade -y

# Instalar Python, Node.js, Nginx
sudo apt install python3 python3-pip nodejs npm nginx -y

# Instalar PM2 para backend
sudo npm install -g pm2</code></pre>

            <h4>7.2.2 Desplegar Backend</h4>
            <pre><code># Clonar repositorio
git clone &lt;URL_REPOSITORIO&gt;
cd BigDataProyect2-Joel

# Configurar entorno virtual
python3 -m venv venv
source venv/bin/activate
pip install -r backend/requirements.txt

# Configurar .env
nano .env  # Editar variables de entorno

# Ejecutar con PM2
cd backend
pm2 start "python -m uvicorn main:app --host 0.0.0.0 --port 8000" --name gamc-backend
pm2 save
pm2 startup  # Seguir instrucciones</code></pre>

            <h4>7.2.3 Desplegar Frontend</h4>
            <pre><code># Build de producci√≥n
cd frontend
npm install
npm run build

# Configurar Nginx
sudo nano /etc/nginx/sites-available/gamc</code></pre>

            <p><strong>Configuraci√≥n Nginx:</strong></p>
            <pre><code>server {
    listen 80;
    server_name tu-dominio.com;

    # Frontend
    location / {
        root /ruta/a/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    # Backend API
    location /api {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}</code></pre>

            <pre><code># Habilitar sitio
sudo ln -s /etc/nginx/sites-available/gamc /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx</code></pre>

            <h4>7.2.4 Configurar SSL (Let's Encrypt)</h4>
            <pre><code>sudo apt install certbot python3-certbot-nginx -y
sudo certbot --nginx -d tu-dominio.com</code></pre>
        </div>

        <div class="section" id="problemas">
            <h2>8. SOLUCI√ìN DE PROBLEMAS</h2>

            <h3>8.1 Backend No Inicia</h3>
            <p><strong>Problema:</strong> <code>ModuleNotFoundError</code> o errores de importaci√≥n</p>
            <p><strong>Soluci√≥n:</strong></p>
            <pre><code># Verificar que el entorno virtual est√° activo
which python  # Deber√≠a mostrar ruta a venv

# Reinstalar dependencias
pip install --upgrade pip
pip install -r backend/requirements.txt --force-reinstall</code></pre>

            <h3>8.2 MongoDB No Conecta</h3>
            <p><strong>Problema:</strong> <code>pymongo.errors.ServerSelectionTimeoutError</code></p>
            <p><strong>Soluciones:</strong></p>
            <ol>
                <li>Verificar que la IP est√° en whitelist de MongoDB Atlas (0.0.0.0/0 para desarrollo)</li>
                <li>Verificar credenciales en <code>.env</code></li>
                <li>Verificar que el cluster est√° activo en MongoDB Atlas</li>
            </ol>

            <h3>8.3 Frontend No Muestra Datos</h3>
            <p><strong>Problema:</strong> Errores 401 (No autorizado) o 404</p>
            <p><strong>Soluciones:</strong></p>
            <ol>
                <li>Verificar que el backend est√° ejecut√°ndose</li>
                <li>Verificar que el token JWT es v√°lido</li>
                <li>Verificar URL del backend en <code>frontend/src/services/api.js</code></li>
            </ol>

            <h3>8.4 Modelo ML No Entrena</h3>
            <p><strong>Problema:</strong> "No se encontraron datos" o "Datos insuficientes"</p>
            <p><strong>Soluciones:</strong></p>
            <ol>
                <li>Verificar que hay datos en MongoDB para el sensor y m√©trica seleccionados</li>
                <li>Ampliar rango de fechas</li>
                <li>Verificar que la m√©trica existe en los datos</li>
            </ol>

            <h3>8.5 Matriz de Confusi√≥n No se Exporta</h3>
            <p><strong>Problema:</strong> Error al guardar imagen PNG</p>
            <p><strong>Soluci√≥n:</strong></p>
            <pre><code># Verificar permisos de escritura
ls -la backend/models/
chmod 755 backend/models/

# Verificar que matplotlib est√° instalado
pip install matplotlib seaborn</code></pre>

            <h3>8.6 Puerto Ya en Uso</h3>
            <p><strong>Problema:</strong> <code>Address already in use</code></p>
            <p><strong>Soluci√≥n:</strong></p>
            <pre><code># Windows: Encontrar proceso
netstat -ano | findstr :8000
taskkill /PID &lt;PID&gt; /F

# Linux/macOS: Encontrar proceso
lsof -i :8000
kill -9 &lt;PID&gt;

# O cambiar puerto
python -m uvicorn main:app --port 8001</code></pre>
        </div>

        <footer>
            <p><strong>Versi√≥n:</strong> 2.0</p>
            <p><strong>Proyecto:</strong> GAMC Big Data Dashboard - Sistema de An√°lisis y Predicci√≥n con Machine Learning</p>
        </footer>
    </div>

    <script>
        function downloadPDF() {
            const element = document.getElementById('content');
            
            // Ocultar bot√≥n antes de generar PDF
            const btn = document.querySelector('.download-btn');
            const originalText = btn ? btn.textContent : '';
            
            if (btn) {
                btn.style.display = 'none';
                btn.textContent = '‚è≥ Generando PDF...';
                btn.disabled = true;
            }

            // Funci√≥n para esperar a que todas las im√°genes se carguen
            function waitForImages(element) {
                return new Promise((resolve) => {
                    const images = element.querySelectorAll('img');
                    let loadedCount = 0;
                    const totalImages = images.length;

                    if (totalImages === 0) {
                        resolve();
                        return;
                    }

                    images.forEach((img) => {
                        if (img.complete) {
                            loadedCount++;
                            if (loadedCount === totalImages) resolve();
                        } else {
                            img.onload = () => {
                                loadedCount++;
                                if (loadedCount === totalImages) resolve();
                            };
                            img.onerror = () => {
                                loadedCount++;
                                if (loadedCount === totalImages) resolve();
                            };
                        }
                    });
                });
            }

            // Scroll al inicio para capturar todo desde el principio
            window.scrollTo(0, 0);
            element.scrollIntoView({ behavior: 'instant', block: 'start' });

            // Esperar a que las im√°genes se carguen y luego generar PDF
            waitForImages(element).then(() => {
                // Esperar un momento adicional para que el scroll se complete
                setTimeout(() => {
                    // Obtener dimensiones completas del contenido
                    const rect = element.getBoundingClientRect();
                    const elementHeight = Math.max(element.scrollHeight, element.offsetHeight, rect.height);
                    const elementWidth = Math.max(element.scrollWidth, element.offsetWidth, rect.width);
                    
                    const opt = {
                        margin: [15, 15, 15, 15],
                        filename: 'Guia_Despliegue_GAMC_BigData_Dashboard.pdf',
                        image: { 
                            type: 'jpeg', 
                            quality: 0.95 
                        },
                        html2canvas: { 
                            scale: 2,
                            useCORS: true,
                            logging: false,
                            scrollY: -window.scrollY,
                            scrollX: -window.scrollX,
                            windowWidth: document.documentElement.scrollWidth || elementWidth,
                            windowHeight: document.documentElement.scrollHeight || elementHeight,
                            height: elementHeight,
                            width: elementWidth,
                            allowTaint: false,
                            letterRendering: true,
                            backgroundColor: '#ffffff',
                            removeContainer: false
                        },
                        jsPDF: { 
                            unit: 'mm', 
                            format: 'a4', 
                            orientation: 'portrait',
                            compress: true
                        },
                        pagebreak: { 
                            mode: ['css', 'legacy'],
                            before: '.section',
                            after: ['h2'],
                            avoid: ['pre', 'table', '.note', '.warning', '.success', 'h3', 'h4', '.toc']
                        },
                        enableLinks: false
                    };

                    html2pdf()
                        .set(opt)
                        .from(element)
                        .save()
                        .then(() => {
                            // Mostrar bot√≥n despu√©s de generar PDF
                            if (btn) {
                                btn.style.display = 'block';
                                btn.textContent = originalText;
                                btn.disabled = false;
                            }
                            console.log('PDF generado exitosamente');
                        })
                        .catch(err => {
                            console.error('Error generando PDF:', err);
                            // Mostrar bot√≥n en caso de error
                            if (btn) {
                                btn.style.display = 'block';
                                btn.textContent = originalText;
                                btn.disabled = false;
                            }
                            alert('Error al generar PDF: ' + (err.message || 'Error desconocido') + '\n\nPor favor, intenta usar la funci√≥n de imprimir del navegador (Ctrl+P) y guarda como PDF.');
                        });
                }, 200);
            });
        }
    </script>
</body>
</html>
